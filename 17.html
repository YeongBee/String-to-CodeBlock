<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Code Block Generator (JSON Theme Fixed)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link id="theme-link" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: #f4f4f9; max-width: 1200px; margin: 0 auto; color: #333; }
        .controls { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end; }
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 12px; font-weight: bold; color: #666; }
        select, input { padding: 10px; border-radius: 6px; border: 1px solid #ddd; font-size: 14px; outline: none; height: 42px; box-sizing: border-box; }
        button { padding: 0 25px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; color: white; height: 42px; font-size: 14px; }
        #btn-convert { background: #007bff; }
        #btn-copy { background: #28a745; }
        .container { display: flex; gap: 20px; height: 500px; margin-bottom: 40px; }
        .box { flex: 1; display: flex; flex-direction: column; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .box-header { padding: 12px 15px; background: #f8f9fa; font-weight: bold; color: #555; border-bottom: 1px solid #eee; }
        textarea { width: 100%; height: 100%; border: none; padding: 15px; resize: none; font-family: 'Consolas', monospace; font-size: 13px; outline: none; box-sizing: border-box; }
        #hidden-area { position: absolute; top: -9999px; visibility: hidden; }
        
        #live-preview-section { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 30px; border: 2px dashed #007bff; min-height: 100px; }
        #live-preview-section h3 { margin-top: 0; color: #007bff; margin-bottom: 15px; font-size: 16px; text-transform: uppercase; letter-spacing: 1px; }

        .theme-preview-section { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .theme-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; }
        .theme-card { border: 1px solid #eee; border-radius: 8px; overflow: hidden; cursor: pointer; text-align: center; padding: 10px; font-size: 14px; font-weight: bold; color: #555; background: #f9f9f9; }
        .theme-visual { height: 60px; display: flex; align-items: center; justify-content: center; font-family: monospace; font-size: 12px; font-weight: bold; }
    </style>
</head>
<body>

    <h1 style="text-align: center;">Code Block Generator (JSON Theme Free)</h1>
    
    <div class="controls">
        <div class="control-group">
            <label>ì–¸ì–´</label>
            <select id="lang-select">
                <option value="java">Java</option>
                <option value="python">Python</option>
                <option value="javascript">JavaScript</option>
                <option value="json">JSON</option>
                <option value="sql">SQL</option>
                <option value="html">HTML</option>
                <option value="css">CSS</option>
                <option value="bash">Bash</option>
                <option value="yaml">YAML</option>
            </select>
        </div>
        <div class="control-group">
            <label>í…Œë§ˆ</label>
            <select id="theme-select" onchange="changeTheme()">
                <option value="vs2015">VS 2015 (Dark)</option>
                <option value="github">GitHub (Light)</option>
                <option value="monokai">Monokai (Dark)</option>
                <option value="atom-one-dark">Atom One Dark</option>
                <option value="dracula">Dracula</option>
                <option value="default">Default</option>
            </select>
        </div>
        <div class="control-group">
            <label>ì œëª©</label>
            <input type="text" id="title-input" placeholder="ì˜ˆ: data.json">
        </div>
        <div class="control-group">
            <label>í°íŠ¸ (px)</label>
            <input type="number" id="font-size-input" value="14" min="10" max="30">
        </div>
        <button id="btn-convert" onclick="convertCode()">ë³€í™˜í•˜ê¸°</button>
        <button id="btn-copy" onclick="copyResult()">ê²°ê³¼ ë³µì‚¬</button>
    </div>

    <div class="container">
        <div class="box">
            <div class="box-header">1. ì†ŒìŠ¤ ì½”ë“œ ì…ë ¥</div>
            <textarea id="input-code" placeholder="ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
        </div>
        <div class="box">
            <div class="box-header">2. ë³€í™˜ëœ HTML ê²°ê³¼</div>
            <textarea id="output-html" readonly placeholder="ë³€í™˜ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìƒì„±ë©ë‹ˆë‹¤."></textarea>
        </div>
    </div>

    <div id="live-preview-section">
        <h3>ğŸ‘ï¸ ë³€í™˜ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°</h3>
        <div id="preview-content"><p style="color: #999;">ë³€í™˜ì„ ëˆ„ë¥´ë©´ ì—¬ê¸°ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</p></div>
    </div>

    <div class="theme-preview-section">
        <h3>ğŸ¨ í…Œë§ˆ ë¹ ë¥¸ ì„ íƒ</h3>
        <div class="theme-grid">
            <div class="theme-card" onclick="selectTheme('vs2015')"><div class="theme-visual" style="background:#1e1e1e; color:#dcdcdc;">VS 2015</div></div>
            <div class="theme-card" onclick="selectTheme('github')"><div class="theme-visual" style="background:#ffffff; color:#24292e; border:1px solid #ddd;">GitHub</div></div>
            <div class="theme-card" onclick="selectTheme('monokai')"><div class="theme-visual" style="background:#272822; color:#f8f8f2;">Monokai</div></div>
            <div class="theme-card" onclick="selectTheme('atom-one-dark')"><div class="theme-visual" style="background:#282c34; color:#abb2bf;">Atom One Dark</div></div>
            <div class="theme-card" onclick="selectTheme('dracula')"><div class="theme-visual" style="background:#282a36; color:#f8f8f2;">Dracula</div></div>
            <div class="theme-card" onclick="selectTheme('default')"><div class="theme-visual" style="background:#f0f0f0; color:#444;">Default</div></div>
        </div>
    </div>

    <div id="hidden-area">
        <pre><code id="temp-code"></code></pre>
    </div>

    <script>
        function changeTheme() {
            const theme = document.getElementById('theme-select').value;
            document.getElementById('theme-link').href = `https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/${theme}.min.css`;
        }
        
        function selectTheme(themeName) {
            document.getElementById('theme-select').value = themeName;
            changeTheme();
            setTimeout(convertCode, 200);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function convertCode() {
            const input = document.getElementById('input-code').value;
            if (!input.trim()) { alert("ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

            const lang = document.getElementById('lang-select').value;
            const title = document.getElementById('title-input').value.trim();
            const fontSize = parseInt(document.getElementById('font-size-input').value);
            const tempCode = document.getElementById('temp-code');

            // 1. í•˜ì´ë¼ì´íŒ…
            tempCode.textContent = input;
            tempCode.className = `language-${lang}`;
            tempCode.removeAttribute('data-highlighted');
            hljs.highlightElement(tempCode);

            // 2. ìƒ‰ìƒ ì¶”ì¶œ (í…Œë§ˆ ììœ ë„ ë³´ì¥)
            const codeStyle = window.getComputedStyle(tempCode);
            let bgColor = codeStyle.backgroundColor;
            let textColor = codeStyle.color;

            // [ìˆ˜ì •] ë°°ê²½ìƒ‰ì´ íˆ¬ëª…ì¼ ë•Œë§Œ ìë™ ë³´ì • (ì‚¬ìš©ì ì„ íƒ í…Œë§ˆ ìƒ‰ìƒ ì¡´ì¤‘)
            if (bgColor === 'rgba(0, 0, 0, 0)' || bgColor === 'transparent') {
                const rgb = textColor.match(/\d+/g);
                if (rgb) {
                    const brightness = (parseInt(rgb[0]) * 299 + parseInt(rgb[1]) * 587 + parseInt(rgb[2]) * 114) / 1000;
                    bgColor = (brightness < 128) ? '#ffffff' : '#1e1e1e';
                } else {
                    bgColor = '#1e1e1e';
                }
            }

            const isDarkBg = (bgColor !== '#ffffff' && bgColor !== 'rgb(255, 255, 255)');

            // [í•µì‹¬ ìˆ˜ì •] JSON ê°•ì œ ìƒ‰ìƒ ì ìš© ë¡œì§ ì œê±°
            // ì´ì œ í…Œë§ˆê°€ ì§€ì •í•œ ì›ë˜ ìƒ‰ìƒì„ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.
            tempCode.querySelectorAll('span').forEach(span => {
                const style = window.getComputedStyle(span);
                span.style.color = style.color; // í…Œë§ˆ ë³¸ì—°ì˜ ìƒ‰ìƒ ìœ ì§€
                span.style.fontWeight = style.fontWeight;
                span.removeAttribute('class');
            });

            // 3. ì¤„ ìƒì„± ë° ë¹ˆ ì¤„ ì œê±°
            let lines = tempCode.innerHTML.split(/\r\n|\r|\n/);
            while (lines.length > 0 && lines[0].trim() === '') lines.shift();
            while (lines.length > 0 && lines[lines.length - 1].trim() === '') lines.pop();

            let lineNumbersHtml = '';
            let codeHtml = '';
            const lineHeight = Math.round(fontSize * 1.5); 

            lines.forEach((lineContent, index) => {
                if (lineContent.length === 0) lineContent = ' ';
                let processedLine = lineContent.replace(/  /g, '&nbsp;&nbsp;');
                
                lineNumbersHtml += `<div style="height: ${lineHeight}px; line-height: ${lineHeight}px;">${index + 1}</div>`;
                codeHtml += `<div style="height: ${lineHeight}px; line-height: ${lineHeight}px; white-space: pre; outline: none;">${processedLine}</div>`;
            });

            // 4. í—¤ë”
            let headerHtml = '';
            if (title) {
                const titleSize = Math.max(12, fontSize - 1);
                const headerBg = isDarkBg ? 'rgba(255, 255, 255, 0.05)' : 'rgba(0, 0, 0, 0.05)';
                const headerBorder = isDarkBg ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                headerHtml = `<div contenteditable="true" style="background-color: ${headerBg}; padding: 8px 15px; border-bottom: 1px solid ${headerBorder}; font-family: sans-serif; font-size: ${titleSize}px; font-weight: bold; color: ${textColor}; opacity: 0.9; outline: none;">${title}</div>`;
            }

            // 5. ìµœì¢… HTML
            const finalHtml = `<!-- ì½”ë“œ ë¸”ë¡ ì‹œì‘ -->
<div style="background-color: ${bgColor}; color: ${textColor}; border-radius: 8px; overflow: hidden; margin: 20px 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); font-family: Consolas, 'Courier New', monospace; font-size: ${fontSize}px;">
${headerHtml}
<div style="display: flex; flex-direction: row; padding: 12px 0;">
<div style="user-select: none; -webkit-user-select: none; text-align: right; padding: 0 10px 0 15px; margin-right: 10px; border-right: 1px solid rgba(128, 128, 128, 0.3); color: ${isDarkBg ? 'rgba(255,255,255,0.4)' : 'rgba(0,0,0,0.4)'}; min-width: 30px; font-family: inherit; pointer-events: none;">
${lineNumbersHtml}
</div>
<div contenteditable="true" style="flex: 1; overflow-x: auto; padding-right: 12px; font-family: inherit; white-space: pre; outline: none;">
${codeHtml}
</div>
</div>
</div>
<!-- ì½”ë“œ ë¸”ë¡ ë -->`;

            document.getElementById('output-html').value = finalHtml.trim();
            document.getElementById('preview-content').innerHTML = finalHtml;
        }

        function copyResult() {
            const outputText = document.getElementById('output-html');
            if (!outputText.value) { alert("ë¨¼ì € [ë³€í™˜í•˜ê¸°]ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”."); return; }
            outputText.select();
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(outputText.value).then(() => alert('HTML ë³µì‚¬ ì™„ë£Œ!')).catch(err => alert('ë³µì‚¬ ì‹¤íŒ¨: ' + err));
            } else {
                document.execCommand('copy');
                alert('HTML ë³µì‚¬ ì™„ë£Œ!');
            }
        }
        
        window.onload = function() {
            document.getElementById('lang-select').value = 'json';
            document.getElementById('input-code').value = '{\n    "theme": "Free Choice",\n    "isFixed": false,\n    "colors": ["GitHub", "Monokai", "Dracula"]\n}';
            setTimeout(convertCode, 500);
        }
    </script>
</body>
</html>
