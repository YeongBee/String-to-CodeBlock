<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Code Generator (Rainbow JSON Fixed)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link id="theme-link" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: #f4f4f9; max-width: 1200px; margin: 0 auto; color: #333; }
        
        .controls { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end; }
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 12px; font-weight: bold; color: #666; }
        select, input { padding: 10px; border-radius: 6px; border: 1px solid #ddd; font-size: 14px; outline: none; height: 42px; box-sizing: border-box; }
        button { padding: 0 25px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; color: white; height: 42px; font-size: 14px; }
        #btn-convert { background: #007bff; }
        #btn-copy { background: #28a745; }

        .container { display: flex; gap: 20px; height: 500px; margin-bottom: 40px; }
        .box { flex: 1; display: flex; flex-direction: column; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .box-header { padding: 12px 15px; background: #f8f9fa; font-weight: bold; color: #555; border-bottom: 1px solid #eee; }
        
        textarea { width: 100%; height: 100%; border: none; padding: 15px; resize: none; font-family: 'Consolas', monospace; font-size: 13px; outline: none; box-sizing: border-box; }
        
        #hidden-area { position: absolute; top: -9999px; visibility: hidden; }
        
        #live-preview-section { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 30px; border: 2px dashed #007bff; min-height: 100px; }
        #live-preview-section h3 { margin-top: 0; color: #007bff; margin-bottom: 15px; font-size: 16px; text-transform: uppercase; letter-spacing: 1px; }

        .theme-preview-section { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .theme-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        
        .theme-card { 
            border: 1px solid #eee; border-radius: 8px; overflow: hidden; cursor: pointer; 
            transition: transform 0.2s, box-shadow 0.2s;
            text-align: left; background: #fff;
        }
        .theme-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-color: #007bff; }
        
        .theme-code-preview {
            padding: 12px; font-family: 'Consolas', monospace; font-size: 12px;
            height: 50px; display: flex; align-items: center; pointer-events: none;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .theme-name { 
            padding: 8px 10px; background: #fff; 
            font-size: 13px; font-weight: bold; color: #555; text-align: center;
        }
    </style>
</head>
<body>

    <h1 style="text-align: center;">Code Generator (Rainbow JSON)</h1>
    
    <div class="controls">
        <div class="control-group">
            <label>ì–¸ì–´</label>
            <select id="lang-select">
                <option value="json">JSON</option> <!-- JSON í…ŒìŠ¤íŠ¸ìš© ê¸°ë³¸ê°’ -->
                <option value="python">Python</option>
                <option value="java">Java</option>
                <option value="javascript">JavaScript</option>
                <option value="sql">SQL</option>
                <option value="html">HTML</option>
                <option value="css">CSS</option>
                <option value="bash">Bash</option>
                <option value="yaml">YAML</option>
            </select>
        </div>
        <div class="control-group">
            <label>í…Œë§ˆ ì„ íƒ</label>
            <select id="theme-select" onchange="changeTheme()">
                <option value="vs2015">VS 2015 (Dark)</option>
                <option value="github">GitHub (Light)</option>
                <option value="monokai">Monokai Classic (Dark)</option>
                <option value="monokai-pro">Monokai Pro (Modern)</option>
                <option value="atom-one-dark">Atom One Dark</option>
                <option value="dracula">Dracula</option>
                <option value="default">Default (Light)</option>
            </select>
        </div>
        <div class="control-group">
            <label>ì œëª©</label>
            <input type="text" id="title-input" placeholder="ì˜ˆ: data.json">
        </div>
        <div class="control-group">
            <label>í°íŠ¸ (px)</label>
            <input type="number" id="font-size-input" value="14" min="10" max="30">
        </div>
        <button id="btn-convert" onclick="convertCode()">ë³€í™˜í•˜ê¸°</button>
        <button id="btn-copy" onclick="copyResult()">ê²°ê³¼ ë³µì‚¬</button>
    </div>

    <div class="container">
        <div class="box">
            <div class="box-header">1. ì†ŒìŠ¤ ì½”ë“œ ì…ë ¥</div>
            <textarea id="input-code" placeholder="ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
        </div>
        <div class="box">
            <div class="box-header">2. ë³€í™˜ëœ HTML ê²°ê³¼</div>
            <textarea id="output-html" readonly placeholder="ë³€í™˜ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìƒì„±ë©ë‹ˆë‹¤."></textarea>
        </div>
    </div>

    <div id="live-preview-section">
        <h3>ğŸ‘ï¸ ë³€í™˜ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°</h3>
        <div id="preview-content"><p style="color: #999;">ë³€í™˜ì„ ëˆ„ë¥´ë©´ ì—¬ê¸°ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</p></div>
    </div>

    <div class="theme-preview-section">
        <h3>ğŸ¨ í…Œë§ˆ ë¹ ë¥¸ ì„ íƒ (Hello World Preview)</h3>
        <div class="theme-grid">
            <div class="theme-card" onclick="selectTheme('vs2015')">
                <div class="theme-code-preview" style="background: #1e1e1e; color: #dcdcdc;">
                    <span>print(<span style="color: #d69d85;">"Hello World"</span>)</span>
                </div>
                <div class="theme-name">VS 2015</div>
            </div>
            
            <div class="theme-card" onclick="selectTheme('github')">
                <div class="theme-code-preview" style="background: #ffffff; color: #24292e;">
                    <span>print(<span style="color: #032f62;">"Hello World"</span>)</span>
                </div>
                <div class="theme-name">GitHub</div>
            </div>

            <div class="theme-card" onclick="selectTheme('monokai')">
                <div class="theme-code-preview" style="background: #272822; color: #f8f8f2;">
                    <span><span style="color: #a6e22e;">print</span>(<span style="color: #e6db74;">"Hello World"</span>)</span>
                </div>
                <div class="theme-name">Monokai Classic</div>
            </div>

            <div class="theme-card" onclick="selectTheme('monokai-pro')">
                <div class="theme-code-preview" style="background: #2d2a2e; color: #fcfcfa;">
                    <span><span style="color: #a9dc76;">print</span>(<span style="color: #ffd866;">"Hello World"</span>)</span>
                </div>
                <div class="theme-name">Monokai Pro</div>
            </div>

            <div class="theme-card" onclick="selectTheme('atom-one-dark')">
                <div class="theme-code-preview" style="background: #282c34; color: #abb2bf;">
                    <span><span style="color: #61aeee;">print</span>(<span style="color: #98c379;">"Hello World"</span>)</span>
                </div>
                <div class="theme-name">Atom One Dark</div>
            </div>

            <div class="theme-card" onclick="selectTheme('dracula')">
                <div class="theme-code-preview" style="background: #282a36; color: #f8f8f2;">
                    <span><span style="color: #50fa7b;">print</span>(<span style="color: #f1fa8c;">"Hello World"</span>)</span>
                </div>
                <div class="theme-name">Dracula</div>
            </div>

            <div class="theme-card" onclick="selectTheme('default')">
                <div class="theme-code-preview" style="background: #f3f3f3; color: #444;">
                    <span>print(<span style="color: #880000;">"Hello World"</span>)</span>
                </div>
                <div class="theme-name">Default</div>
            </div>
        </div>
    </div>

    <div id="hidden-area">
        <pre><code id="temp-code"></code></pre>
    </div>

    <script>
        function changeTheme() {
            const theme = document.getElementById('theme-select').value;
            let cssTheme = theme === 'monokai-pro' ? 'monokai-sublime' : theme;
            document.getElementById('theme-link').href = `https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/${cssTheme}.min.css`;
        }
        
        function selectTheme(themeName) {
            document.getElementById('theme-select').value = themeName;
            changeTheme();
            setTimeout(convertCode, 200);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // [New] ë ˆì¸ë³´ìš° ë¸Œë¼ì¼“ ìƒ‰ìƒ íŒ”ë ˆíŠ¸ (ë…¸ë‘ -> í•‘í¬ -> ë¸”ë£¨ -> ë³´ë¼)
        const RAINBOW_COLORS = ['#ffd866', '#ff6188', '#78dce8', '#ab9df2'];

        function convertCode() {
            const input = document.getElementById('input-code').value;
            let cleanInput = input.replace(/^\s*[\r\n]+/, '').replace(/\s+$/, '');
            if (!cleanInput) { alert("ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

            const lang = document.getElementById('lang-select').value;
            const theme = document.getElementById('theme-select').value;
            const title = document.getElementById('title-input').value.trim();
            const fontSize = parseInt(document.getElementById('font-size-input').value);
            const tempCode = document.getElementById('temp-code');

            // 1. í•˜ì´ë¼ì´íŒ…
            tempCode.textContent = cleanInput;
            tempCode.className = `language-${lang}`;
            tempCode.removeAttribute('data-highlighted');
            hljs.highlightElement(tempCode);

            // 2. ìƒ‰ìƒ ì¶”ì¶œ ë° ë°°ê²½ ê°ì§€
            const codeStyle = window.getComputedStyle(tempCode);
            let bgColor = codeStyle.backgroundColor;
            let textColor = codeStyle.color;

            if (bgColor === 'rgba(0, 0, 0, 0)' || bgColor === 'transparent') {
                const rgb = textColor.match(/\d+/g);
                if (rgb) {
                    const brightness = (parseInt(rgb[0]) * 299 + parseInt(rgb[1]) * 587 + parseInt(rgb[2]) * 114) / 1000;
                    bgColor = (brightness < 128) ? '#ffffff' : '#1e1e1e';
                } else {
                    bgColor = '#1e1e1e';
                }
            }
            
            if (theme === 'dracula') {
                bgColor = '#282a36'; textColor = '#f8f8f2';
            } else if (theme === 'monokai-pro') {
                bgColor = '#2d2a2e'; textColor = '#fcfcfa';
            }

            let isDarkBg = true;
            if (bgColor.startsWith('rgb')) {
                const rgbValues = bgColor.match(/\d+/g);
                if (rgbValues) {
                    const brightness = (parseInt(rgbValues[0]) * 299 + parseInt(rgbValues[1]) * 587 + parseInt(rgbValues[2]) * 114) / 1000;
                    isDarkBg = brightness < 128; 
                }
            } else if (bgColor === '#ffffff' || bgColor === '#f3f3f3') {
                isDarkBg = false;
            }

            const lineNumberColor = isDarkBg ? 'rgba(255, 255, 255, 0.4)' : 'rgba(0, 0, 0, 0.3)';
            const separatorColor = isDarkBg ? 'rgba(128, 128, 128, 0.3)' : 'rgba(0, 0, 0, 0.15)';

            // [ë³´ì • ë¡œì§ ì ìš©]
            tempCode.querySelectorAll('span').forEach(span => {
                const style = window.getComputedStyle(span);
                let color = style.color;
                
                if (theme === 'monokai') {
                     if (span.classList.contains('hljs-string')) color = '#e6db74'; 
                }
                
                if (theme === 'monokai-pro') {
                    if (span.classList.contains('hljs-string')) color = '#ffd866'; 
                    else if (span.classList.contains('hljs-keyword')) color = '#ff6188'; 
                    else if (span.classList.contains('hljs-function') || span.classList.contains('hljs-title')) color = '#a9dc76'; 
                    else if (span.classList.contains('hljs-built_in') || span.classList.contains('hljs-type')) color = '#78dce8'; 
                    else if (span.classList.contains('hljs-number') || span.classList.contains('hljs-literal')) color = '#ab9df2'; 
                    else if (span.classList.contains('hljs-comment')) color = '#727072';
                    // [JSON í‚¤ ë³´ì •] Monokai Pro JSON Key -> White
                    if (lang === 'json' && span.classList.contains('hljs-attr')) {
                        color = '#fcfcfa'; // White
                    }
                }
                
                if (theme === 'dracula') {
                    if (span.classList.contains('hljs-string')) color = '#f1fa8c';
                    else if (span.classList.contains('hljs-function') || span.classList.contains('hljs-title')) color = '#50fa7b';
                    else if (span.classList.contains('hljs-keyword') || span.classList.contains('hljs-tag')) color = '#ff79c6';
                    else if (span.classList.contains('hljs-comment')) color = '#6272a4';
                    else if (span.classList.contains('hljs-attr')) color = '#50fa7b';
                    else if (span.classList.contains('hljs-number') || span.classList.contains('hljs-literal')) color = '#bd93f9';
                    else if (span.classList.contains('hljs-built_in') || span.classList.contains('hljs-type')) {
                        color = '#8be9fd';
                        span.style.fontStyle = 'italic';
                    }
                }
                
                span.style.color = color;
                if (theme !== 'dracula' || (!span.classList.contains('hljs-built_in') && !span.classList.contains('hljs-type'))) {
                     span.style.fontWeight = style.fontWeight;
                }
                span.removeAttribute('class');
            });

            // 3. ì¤„ ë¶„ë¦¬
            let lines = tempCode.innerHTML.split(/\r\n|\r|\n/);
            while (lines.length > 0 && lines[0].replace(/&nbsp;/g, '').trim() === '') lines.shift();
            while (lines.length > 0 && lines[lines.length - 1].replace(/&nbsp;/g, '').trim() === '') lines.pop();

            let lineNumbersHtml = '';
            let codeHtml = '';
            const lineHeight = Math.round(fontSize * 1.5); 
            
            // [Rainbow Bracket State]
            let bracketDepth = 0; 

            lines.forEach((lineContent, index) => {
                if (lineContent.length === 0) lineContent = ' ';
                
                // [Monokai Pro & JSONì¼ ë•Œë§Œ ë ˆì¸ë³´ìš° ë¸Œë¼ì¼“ ì ìš©]
                if (theme === 'monokai-pro' && lang === 'json') {
                    // ë‹¨ìˆœ ë¬¸ìì—´ ì¹˜í™˜ì€ HTML íƒœê·¸ë¥¼ ê¹° ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ì²˜ë¦¬í•´ì•¼ í•¨
                    // ì—¬ê¸°ì„œëŠ” í…ìŠ¤íŠ¸ ë…¸ë“œë§Œ ì°¾ì•„ì„œ ê´„í˜¸ ìƒ‰ìƒì„ ì…íˆëŠ” ê²ƒì´ ê°€ì¥ ì•ˆì „í•˜ì§€ë§Œ, 
                    // ê°„ë‹¨íˆ ì •ê·œì‹ìœ¼ë¡œ ì²˜ë¦¬ (íƒœê·¸ ë‚´ë¶€ê°€ ì•„ë‹Œ ê´„í˜¸ë§Œ)
                    
                    // ê´„í˜¸ í•˜ë‚˜í•˜ë‚˜ë¥¼ spanìœ¼ë¡œ ê°ì‹¸ì„œ ìƒ‰ìƒ ë¶€ì—¬
                    let rainbowLine = '';
                    let tempLine = lineContent;
                    
                    // span íƒœê·¸ê°€ ì´ë¯¸ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, íƒœê·¸ ë°–ì˜ í…ìŠ¤íŠ¸ë§Œ ì²˜ë¦¬í•˜ê¸°ëŠ” ë³µì¡í•¨.
                    // ëŒ€ì‹ , highlight.jsê°€ ì²˜ë¦¬í•˜ì§€ ì•Šì€(spanìœ¼ë¡œ ì•ˆ ê°ì‹¸ì§„) ê´„í˜¸ë“¤ ìœ„ì£¼ë¡œ ì²˜ë¦¬
                    // (highlight.jsëŠ” ë³´í†µ ê´„í˜¸ì—ëŠ” í´ë˜ìŠ¤ë¥¼ ì•ˆ ì”Œì›€)
                    
                    // ì •ê·œì‹ìœ¼ë¡œ '{', '}', '[', ']' ì°¾ì•„ì„œ ìƒ‰ìƒ ì…íˆê¸°
                    // ë‹¨, ì´ë¯¸ span íƒœê·¸ ì•ˆì— ìˆëŠ” ê´„í˜¸(ë¬¸ìì—´ ë‚´ë¶€ ë“±)ëŠ” ê±´ë“œë¦¬ë©´ ì•ˆë¨.
                    // í•˜ì§€ë§Œ JSONì—ì„œ êµ¬ì¡°ì  ê´„í˜¸ëŠ” ë³´í†µ íƒœê·¸ ë°–ì— ìˆìŒ (punctuation)
                    
                    // ê´„í˜¸ ìƒ‰ìƒ ì…íˆê¸° í•¨ìˆ˜
                    const colorizeBracket = (match) => {
                        let color = RAINBOW_COLORS[bracketDepth % RAINBOW_COLORS.length];
                        if (match === '{' || match === '[') {
                            const span = `<span style="color: ${color}; font-weight: bold;">${match}</span>`;
                            bracketDepth++; // ì—´ë¦¬ë©´ ê¹Šì´ ì¦ê°€
                            return span;
                        } else {
                            bracketDepth = Math.max(0, bracketDepth - 1); // ë‹«íˆë©´ ê¹Šì´ ê°ì†Œ (ë¨¼ì € ê°ì†Œ í›„ ìƒ‰ìƒ ì ìš©)
                            color = RAINBOW_COLORS[bracketDepth % RAINBOW_COLORS.length]; // ë‹«ëŠ” ê´„í˜¸ëŠ” ì—´ë¦° ê´„í˜¸ì™€ ê°™ì€ ìƒ‰
                            return `<span style="color: ${color}; font-weight: bold;">${match}</span>`;
                        }
                    };

                    // HTML íƒœê·¸ê°€ ì•„ë‹Œ ìˆœìˆ˜ í…ìŠ¤íŠ¸ì˜ ê´„í˜¸ë§Œ ì°¾ì•„ì„œ êµì²´ (ê°„ì´ íŒŒì„œ)
                    // (ì™„ë²½í•œ íŒŒì‹±ì€ ë³µì¡í•˜ë¯€ë¡œ ì—¬ê¸°ì„  ê°„ë‹¨íˆ ì²˜ë¦¬: íƒœê·¸ ë°–ì˜ ê´„í˜¸ë§Œ íƒ€ê²ŸíŒ…)
                    let processed = '';
                    let inTag = false;
                    for (let i = 0; i < tempLine.length; i++) {
                        const char = tempLine[i];
                        if (char === '<') inTag = true;
                        if (char === '>') inTag = false;

                        if (!inTag && (char === '{' || char === '[' || char === '}' || char === ']')) {
                            processed += colorizeBracket(char);
                        } else {
                            processed += char;
                        }
                    }
                    lineContent = processed;
                }

                let processedLine = lineContent.replace(/  /g, '&nbsp;&nbsp;');
                
                lineNumbersHtml += `<div style="height: ${lineHeight}px; line-height: ${lineHeight}px;">${index + 1}</div>`;
                codeHtml += `<div style="height: ${lineHeight}px; line-height: ${lineHeight}px; white-space: pre; outline: none;">${processedLine}</div>`;
            });

            // 4. í—¤ë”
            let headerHtml = '';
            if (title) {
                const titleSize = Math.max(12, fontSize - 1);
                const headerBg = isDarkBg ? 'rgba(255, 255, 255, 0.05)' : 'rgba(0, 0, 0, 0.05)';
                const headerBorder = isDarkBg ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                headerHtml = `<div contenteditable="true" style="background-color: ${headerBg}; padding: 8px 15px; border-bottom: 1px solid ${headerBorder}; font-family: sans-serif; font-size: ${titleSize}px; font-weight: bold; color: ${textColor}; opacity: 0.9; outline: none;">${title}</div>`;
            }

            // 5. ìµœì¢… HTML
            const finalHtml = `<!-- ì½”ë“œ ë¸”ë¡ ì‹œì‘ -->
<div style="background-color: ${bgColor}; color: ${textColor}; border-radius: 8px; overflow: hidden; margin: 20px 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); font-family: Consolas, 'Courier New', monospace; font-size: ${fontSize}px;">
${headerHtml}
<div style="display: flex; flex-direction: row; padding: 12px 0; overflow-y: hidden !important;">
<div style="user-select: none; -webkit-user-select: none; text-align: right; padding: 0 10px 0 15px; margin-right: 10px; border-right: 1px solid ${separatorColor}; color: ${lineNumberColor}; min-width: 30px; font-family: inherit; pointer-events: none;">${lineNumbersHtml}</div>
<div contenteditable="true" style="flex: 1; overflow-x: auto; overflow-y: hidden !important; padding-right: 12px; font-family: inherit; white-space: pre; outline: none; height: auto !important; max-height: none !important;">${codeHtml}</div>
</div>
</div>
<!-- ì½”ë“œ ë¸”ë¡ ë -->`;

            document.getElementById('output-html').value = finalHtml.trim();
            document.getElementById('preview-content').innerHTML = finalHtml;
        }

        function copyResult() {
            const outputText = document.getElementById('output-html');
            if (!outputText.value) { alert("ë¨¼ì € [ë³€í™˜í•˜ê¸°]ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”."); return; }
            outputText.select();
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(outputText.value).then(() => alert('HTML ë³µì‚¬ ì™„ë£Œ!')).catch(err => alert('ë³µì‚¬ ì‹¤íŒ¨: ' + err));
            } else {
                document.execCommand('copy');
                alert('HTML ë³µì‚¬ ì™„ë£Œ!');
            }
        }
        
        window.onload = function() {
            document.getElementById('lang-select').value = 'json';
            document.getElementById('input-code').value = '{\n  "name": "Monokai Pro",\n  "features": [\n    "Rainbow Brackets",\n    "White Keys"\n  ]\n}';
            setTimeout(convertCode, 500);
        }
    </script>
</body>
</html>
