<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì½”ë“œ ë³€í™˜ê¸° (ì™„ì „íŒ - í…Œë§ˆ ë¯¸ë¦¬ë³´ê¸° í¬í•¨)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link id="theme-link" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs2015.min.css">
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: #f4f4f9; max-width: 1200px; margin: 0 auto; color: #333; }
        
        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .controls { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end; }
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 12px; font-weight: bold; color: #666; }
        select, input { padding: 10px; border-radius: 6px; border: 1px solid #ddd; font-size: 14px; outline: none; height: 42px; box-sizing: border-box; }
        button { padding: 0 25px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; color: white; height: 42px; font-size: 14px; }
        #btn-convert { background: #007bff; }
        #btn-copy { background: #28a745; }
        
        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .container { display: flex; gap: 20px; height: 500px; margin-bottom: 40px; }
        .box { flex: 1; display: flex; flex-direction: column; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .box-header { padding: 12px 15px; background: #f8f9fa; font-weight: bold; color: #555; border-bottom: 1px solid #eee; }
        textarea { width: 100%; height: 100%; border: none; padding: 15px; resize: none; font-family: 'Consolas', monospace; font-size: 13px; outline: none; box-sizing: border-box; }
        
        #hidden-area { position: absolute; top: -9999px; visibility: hidden; }

        /* í…Œë§ˆ ë¯¸ë¦¬ë³´ê¸° ì„¹ì…˜ */
        .theme-preview-section { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .theme-preview-section h3 { margin-top: 0; color: #444; margin-bottom: 20px; }
        .theme-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; }
        
        .theme-card {
            border: 1px solid #eee; border-radius: 8px; overflow: hidden; cursor: pointer; 
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .theme-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        .theme-visual { height: 80px; display: flex; align-items: center; justify-content: center; font-family: monospace; font-size: 12px; font-weight: bold; }
        .theme-name { padding: 10px; text-align: center; font-size: 14px; font-weight: bold; background: #f9f9f9; color: #555; border-top: 1px solid #eee; }
    </style>
</head>
<body>

    <h1 style="text-align: center;">Code Block Generator (Final Complete)</h1>
    
    <div class="controls">
        <div class="control-group">
            <label>ì–¸ì–´</label>
            <select id="lang-select">
                <option value="java">Java</option>
                <option value="python">Python</option>
                <option value="javascript">JavaScript</option>
                <option value="json">JSON</option>
                <option value="sql">SQL</option>
                <option value="html">HTML</option>
                <option value="css">CSS</option>
                <option value="bash">Bash</option>
                <option value="yaml">YAML</option>
            </select>
        </div>
        <div class="control-group">
            <label>í…Œë§ˆ</label>
            <select id="theme-select" onchange="changeTheme()">
                <option value="vs2015">VS 2015 (Dark)</option>
                <option value="github">GitHub (Light)</option>
                <option value="monokai">Monokai (Dark)</option>
                <option value="atom-one-dark">Atom One Dark</option>
                <option value="dracula">Dracula</option>
                <option value="default">Default</option>
            </select>
        </div>
        <div class="control-group">
            <label>ì œëª©</label>
            <input type="text" id="title-input" placeholder="ì˜ˆ: app.py">
        </div>
        <div class="control-group">
            <label>í°íŠ¸ (px)</label>
            <input type="number" id="font-size-input" value="14" min="10" max="30">
        </div>
        <button id="btn-convert" onclick="convertCode()">ë³€í™˜í•˜ê¸°</button>
        <button id="btn-copy" onclick="copyResult()">ê²°ê³¼ ë³µì‚¬</button>
    </div>

    <div class="container">
        <div class="box">
            <div class="box-header">1. ì†ŒìŠ¤ ì½”ë“œ ì…ë ¥</div>
            <textarea id="input-code" placeholder="ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
        </div>
        <div class="box">
            <div class="box-header">2. ë³€í™˜ëœ HTML ê²°ê³¼</div>
            <textarea id="output-html" readonly placeholder="ë³€í™˜ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìƒì„±ë©ë‹ˆë‹¤."></textarea>
        </div>
    </div>

    <div class="theme-preview-section">
        <h3>ğŸ¨ í…Œë§ˆ ë¯¸ë¦¬ë³´ê¸° (í´ë¦­í•˜ì—¬ ì„ íƒ)</h3>
        <div class="theme-grid">
            
            <div class="theme-card" onclick="selectTheme('vs2015')">
                <div class="theme-visual" style="background: #1e1e1e; color: #dcdcdc;">
                    <span style="color: #569cd6">public</span>&nbsp;void
                </div>
                <div class="theme-name">VS 2015</div>
            </div>

            <div class="theme-card" onclick="selectTheme('github')">
                <div class="theme-visual" style="background: #ffffff; color: #24292e; border-bottom: 1px solid #ddd;">
                    <span style="color: #d73a49">import</span>&nbsp;sys
                </div>
                <div class="theme-name">GitHub (Light)</div>
            </div>

            <div class="theme-card" onclick="selectTheme('monokai')">
                <div class="theme-visual" style="background: #272822; color: #f8f8f2;">
                    <span style="color: #f92672">def</span>&nbsp;func()
                </div>
                <div class="theme-name">Monokai</div>
            </div>

            <div class="theme-card" onclick="selectTheme('atom-one-dark')">
                <div class="theme-visual" style="background: #282c34; color: #abb2bf;">
                    <span style="color: #c678dd">const</span>&nbsp;val
                </div>
                <div class="theme-name">Atom One Dark</div>
            </div>

            <div class="theme-card" onclick="selectTheme('dracula')">
                <div class="theme-visual" style="background: #282a36; color: #f8f8f2;">
                    <span style="color: #ff79c6">class</span>&nbsp;Main
                </div>
                <div class="theme-name">Dracula</div>
            </div>

            <div class="theme-card" onclick="selectTheme('default')">
                <div class="theme-visual" style="background: #f0f0f0; color: #444;">
                    <span style="font-weight: bold; color: #333;">var</span>&nbsp;x = 1;
                </div>
                <div class="theme-name">Default</div>
            </div>

        </div>
    </div>

    <div id="hidden-area">
        <pre><code id="temp-code"></code></pre>
    </div>

    <script>
        function changeTheme() {
            const theme = document.getElementById('theme-select').value;
            document.getElementById('theme-link').href = `https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/${theme}.min.css`;
        }
        
        function selectTheme(themeName) {
            document.getElementById('theme-select').value = themeName;
            changeTheme();
            // ë¶€ë“œëŸ½ê²Œ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function convertCode() {
            const input = document.getElementById('input-code').value;
            if (!input.trim()) { alert("ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

            const lang = document.getElementById('lang-select').value;
            const title = document.getElementById('title-input').value.trim();
            const fontSize = document.getElementById('font-size-input').value;
            const tempCode = document.getElementById('temp-code');
            const hiddenArea = document.getElementById('hidden-area');

            // 1. í•˜ì´ë¼ì´íŒ…
            tempCode.textContent = input;
            tempCode.className = `language-${lang}`;
            tempCode.removeAttribute('data-highlighted');
            hljs.highlightElement(tempCode);

            // 2. ìŠ¤íƒ€ì¼ ì¶”ì¶œ ë° ìƒ‰ìƒ ë³´ì •
            const codeStyle = window.getComputedStyle(tempCode);
            let bgColor = codeStyle.backgroundColor;
            let textColor = codeStyle.color;

            if (bgColor === 'rgba(0, 0, 0, 0)' || bgColor === 'transparent' || (lang === 'json' && bgColor === 'rgb(0, 0, 0)')) {
                bgColor = '#1e1e1e';
            }
            
            const rgb = textColor.match(/\d+/g);
            if (rgb) {
                const brightness = (parseInt(rgb[0]) * 299 + parseInt(rgb[1]) * 587 + parseInt(rgb[2]) * 114) / 1000;
                if (brightness < 50 && bgColor === '#1e1e1e') textColor = '#d4d4d4';
            }

            tempCode.querySelectorAll('span').forEach(span => {
                const style = window.getComputedStyle(span);
                let color = style.color;
                
                if (lang === 'json') {
                    if (span.classList.contains('hljs-attr')) color = '#9cdcfe';
                    else if (span.classList.contains('hljs-string')) color = '#ce9178';
                    else if (span.classList.contains('hljs-number')) color = '#b5cea8';
                    else if (span.classList.contains('hljs-literal')) color = '#569cd6';
                }
                
                span.style.color = color;
                span.style.fontWeight = style.fontWeight;
                span.removeAttribute('class');
            });

            // 3. ì¤„ ìƒì„± (Table Rows)
            const lines = tempCode.innerHTML.split(/\r\n|\r|\n/);
            let rowsHtml = '';
            if (lines[lines.length - 1] === '') lines.pop();

            lines.forEach((lineContent, index) => {
                if (lineContent.trim() === '') lineContent = ' ';
                
                rowsHtml += `
                <tr style="vertical-align: top; border: none !important; background: none !important;">
                    <td style="
                        user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;
                        text-align: right;
                        padding: 0 10px 0 0 !important;
                        border: none !important;
                        border-right: 1px solid rgba(128, 128, 128, 0.3) !important;
                        background: none !important;
                        color: rgba(255, 255, 255, 0.4);
                        white-space: nowrap !important;
                        vertical-align: top;
                        width: 30px;
                    ">${index + 1}</td>
                    <td style="
                        padding-left: 10px !important;
                        border: none !important;
                        background: none !important;
                        white-space: pre !important;
                        vertical-align: top;
                        overflow-wrap: normal !important;
                        word-break: keep-all !important;
                        font-family: 'Consolas', 'Courier New', monospace !important;
                    ">${lineContent}</td>
                </tr>`;
            });

            // 4. ì œëª© í—¤ë”
            let headerHtml = '';
            if (title) {
                const titleSize = Math.max(12, fontSize - 1);
                headerHtml = `<div style="background-color: rgba(255, 255, 255, 0.05); padding: 8px 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); font-family: sans-serif; font-size: ${titleSize}px; font-weight: bold; color: ${textColor}; opacity: 0.9;">${title}</div>`;
            }

            // 5. ìµœì¢… HTML
            const finalHtml = `<!-- ì½”ë“œ ë¸”ë¡ ì‹œì‘ -->
<div style="background-color: ${bgColor}; color: ${textColor}; border-radius: 8px; overflow: hidden; margin: 20px 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); font-family: Consolas, 'Courier New', monospace; font-size: ${fontSize}px; line-height: 1.5;">
${headerHtml}
<div style="overflow-x: auto; padding: 12px 15px;">
    <table style="border-collapse: collapse !important; border: none !important; width: 100% !important; margin: 0 !important; padding: 0 !important; background: none !important; table-layout: auto !important;">
        <tbody style="border: none !important; margin: 0 !important; padding: 0 !important; background: none !important;">
            ${rowsHtml}
        </tbody>
    </table>
</div>
</div>
<!-- ì½”ë“œ ë¸”ë¡ ë -->`;

            document.getElementById('output-html').value = finalHtml.trim();
        }

        function copyResult() {
            const outputText = document.getElementById('output-html');
            if (!outputText.value) { alert("ë¨¼ì € [ë³€í™˜í•˜ê¸°]ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”."); return; }
            outputText.select();
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(outputText.value).then(() => alert('HTML ë³µì‚¬ ì™„ë£Œ!')).catch(err => alert('ë³µì‚¬ ì‹¤íŒ¨: ' + err));
            } else {
                document.execCommand('copy');
                alert('HTML ë³µì‚¬ ì™„ë£Œ!');
            }
        }
        
        window.onload = function() {
            document.getElementById('input-code').value = 'public class FinalCode {\n    public static void main(String[] args) {\n        System.out.println("Enjoy your coding!");\n    }\n}';
        }
    </script>
</body>
</html>
